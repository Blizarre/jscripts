<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<link rel="stylesheet" type="text/css" href="normalize.css">
		<script src="minified-web.js" ></script>
		<script src="webgl.js" ></script>
		<script src="fractal.js" ></script>
		<script type="x-shader/x-fragment" id="fractal">
			precision highp float;
uniform vec2 u_fractalPosition;
uniform vec2 u_cJulia;
uniform float u_fractalZoom;
uniform float u_brightness;
uniform float u_contrast;
uniform int u_highQuality;

float computeLowQuality(in vec2 z)//, out float value)
{
	vec2 z2;
	float tmp;
	int iterNumber;
	
	// start at 1, since Log(0) = NaN
	for(int i = 1; i < 1024; i++)
	{
		z2 = vec2(z.x * z.x, z.y * z.y); // z2x = zx * zx; z2y = zy * zy

		if( (z2.x + z2.y) > 4.0)
		{
				iterNumber = i;
				break;
		}
				
		tmp = z2.x - z2.y + u_cJulia.x;
		z.y = 2.0 * z.x * z.y + u_cJulia.y;
		z.x = tmp;
	}
	
	return log(float(iterNumber));      
}

float computeHighQuality(in vec2 z)//, out float value)
{
	vec2 z2;
	float tmp, value;
	int iterNumber;
	
	// start at 1, since Log(0) = NaN
	for(int i = 1; i < 4096; i++)
	{
		z2 = vec2(z.x * z.x, z.y * z.y); // z2x = zx * zx; z2y = zy * zy

		if( (z2.x + z2.y) > 16.0)
		{
				iterNumber = i;
				break;
		}
				
		tmp = z2.x - z2.y + u_cJulia.x;
		z.y = 2.0 * z.x * z.y + u_cJulia.y;
		z.x = tmp;
			
	}

	// Smoothing the fractal: result = IterNumber - log2( log( abs(z) / log(N) ) )
	value = float(iterNumber) - log2( log( sqrt( z.x * z.x + z.y * z.y )/log(4.0)) );
	return log(value);  

}


void main(void)
{
	vec2 z = vec2( (gl_FragCoord.x/u_fractalZoom - u_fractalPosition.x), (gl_FragCoord.y/u_fractalZoom - u_fractalPosition.y) );
	float value;
	
	if(u_highQuality != 0)
		value = computeHighQuality(z);
	else
		value = computeLowQuality(z);
	
	
	gl_FragColor =  vec4( u_brightness + u_contrast * vec3(value, value, value) * vec3(0.8, 0.75, 1.0), 1.0); 
}
		</script>

		<script type="x-shader/x-vertex" id="vertexShader">
attribute vec2 a_position;

uniform mat4 uMVMatrix;
uniform mat4 uPMatrix;

void main(void) {
	gl_Position = vec4(a_position, 0, 1);
} 
		</script>
		<style>
.control {
    width: 256px;
    margin-left: auto;
    margin-right: auto;
    text-align:center;
    margin-top: 10px;

    border-top: 1px solid black;
}
		</style>
	</head>
	<body>
		<div style="width:100%; text-align:center; margin:10 px;"><canvas id="fractalCanvas">No canvas support</canvas></div>
		<div class='control'>c0: <input type="range" id="c0" min="0" max="100" step="1" value="10" /><input size="5" id="c0_value"></div>
		<div class='control'>c1: <input type="range" id="c1" min="0" max="100" step="1" value="10" /><input size="5" id="c1_value"></div>
		<div class='control'>
			Brightness: <input type="range" id="brightness" min="0" max="100" step="1" value="100" /><input size="5" id="brightness_value" /><br/>
			Contrast: <input type="range" id="contrast" min="0" max="100" step="1" value="100" /><input size="5" id="contrast_value" />
		</div>
		<div class='control'>Canvas Size :<br/><input type="button" id="small" value="Small" /> <input type="button" id="medium" value="Medium" /> <input type="button" id="maximum" value="Maximum" /></div>
		<div class='control'>High quality: <br/><input type="checkbox" id="highQuality" value="false" /></div> 
		<div class='control'><input type="button" id="animate" value="Animate" /> Full Screen: <input type="button" id="fullscreen" value="Fullscreen" /></div>
		<div class='control'>Show Log: <input type="checkbox" id="showLog" checked="false" /><input type="button" id="reset" value="Reset" /></div> 
		<div><textarea style="width:100%; height:100px;" id="logger"></textarea></div>
	</body>
</html>